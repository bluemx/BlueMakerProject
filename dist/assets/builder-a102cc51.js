import{G as U,n as R,T as H,u as X,l as b,s as g,_ as F}from"./app-c8e81ced.js";var L={};L._getBinaryFromXHR=function(p){return p.response||p.responseText};function M(){try{return new window.XMLHttpRequest}catch{}}function D(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch{}}var P=typeof window<"u"&&window.ActiveXObject?function(){return M()||D()}:M;L.getBinaryContent=function(p,c){var i,f,l,v;c||(c={}),typeof c=="function"?(v=c,c={}):typeof c.callback=="function"&&(v=c.callback),!v&&typeof Promise<"u"?i=new Promise(function(r,w){f=r,l=w}):(f=function(r){v(null,r)},l=function(r){v(r,null)});try{var a=P();a.open("GET",p,!0),"responseType"in a&&(a.responseType="arraybuffer"),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.onreadystatechange=function(r){if(a.readyState===4)if(a.status===200||a.status===0)try{f(L._getBinaryFromXHR(a))}catch(w){l(new Error(w))}else l(new Error("Ajax error for "+p+" : "+this.status+" "+this.statusText))},c.progress&&(a.onprogress=function(r){c.progress({path:p,originalEvent:r,percent:r.loaded/r.total*100,loaded:r.loaded,total:r.total})}),a.send()}catch(r){l(new Error(r),null)}return i};var q=L;const x=U(q);var O={exports:{}};(function(p,c){(function(i,f){f()})(R,function(){function i(e,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e}function f(e,t,m){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){w(n.response,t,m)},n.onerror=function(){console.error("could not download file")},n.send()}function l(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function v(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof R=="object"&&R.global===R?R:void 0,r=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),w=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(e,t,m){var n=a.URL||a.webkitURL,u=document.createElement("a");t=t||e.name||"download",u.download=t,u.rel="noopener",typeof e=="string"?(u.href=e,u.origin===location.origin?v(u):l(u.href)?f(e,t,m):v(u,u.target="_blank")):(u.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(u.href)},4e4),setTimeout(function(){v(u)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,m){if(t=t||e.name||"download",typeof e!="string")navigator.msSaveOrOpenBlob(i(e,m),t);else if(l(e))f(e,t,m);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){v(n)})}}:function(e,t,m,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return f(e,t,m);var u=e.type==="application/octet-stream",_=/constructor/i.test(a.HTMLElement)||a.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent);if((h||u&&_||r)&&typeof FileReader<"u"){var A=new FileReader;A.onloadend=function(){var E=A.result;E=h?E:E.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=E:location=E,n=null},A.readAsDataURL(e)}else{var S=a.URL||a.webkitURL,T=S.createObjectURL(e);n?n.location=T:location.href=T,n=null,setTimeout(function(){S.revokeObjectURL(T)},4e4)}});a.saveAs=w.saveAs=w,p.exports=w})})(O);var C=O.exports;const J=U(C),$=H("builder",()=>{const p=X(),c=b(null),i=b(null),f=b(),l=b(),v=b(null),a=b(),r=b({}),w=b([]),e=async()=>{const{data:o,error:d}=await g.from("usertemplates").select("*").eq("type",c.value);return o.value=o,o},t=async(o,d)=>{const{data:s,error:j}=await g.from("documents").insert([{key:o,content:d}]).select().single();p.push(`/${c.value}/${s.key}`)},m=async o=>{l.value=o;const{data:d,error:s}=await g.from("documents").select("*").eq("key",o).single();return i.value=d,T(),!0},n=()=>i.value?i.value.content:null,u=o=>{const{data:d}=g.storage.from(c.value).getPublicUrl(l.value+"/"+o);return d.publicUrl},_=async()=>{await g.from("documents").update(i.value).eq("key",l.value)},h=()=>{},A=async()=>{const{data:o,error:d}=await g.from("modulos").select("*").eq("type",c.value);return o.value=o,o==null||o.forEach(s=>{r.value[s.name]={...s.schema,icon:s.icon,color:s.color}}),o},S=o=>r.value[o],T=async()=>{f.value=[];const{data:o,error:d}=await g.storage.from(c.value).list(l.value,{limit:100,offset:0,sortBy:{column:"name",order:"asc"}});o.forEach(s=>{f.value.push({name:s.name,url:u(s.name),mimetype:s.metadata.mimetype})})},E=(o,d)=>{var s;(s=i.value.content)!=null&&s.metadata||(i.value.content.metadata={}),i.value.content.metadata[o]=d},B=async o=>new Promise(function(d,s){x.getBinaryContent(o,function(j,k){j?s(j):d(k)})});return{menu:v,usertemplates:w,type:c,doc:i,dockey:l,files:f,modulos:a,modulosobj:r,newDoc:t,loadDoc:m,getContent:n,updateAssets:T,saveDoc:_,downloadDoc:h,loadModulos:A,metadata:E,download:async()=>{const o=await F(()=>import("./jszip-91ed46b9.js").then(y=>y.j),["assets/jszip-91ed46b9.js","assets/app-c8e81ced.js","assets/index-3ec50c06.css"]);console.trace("download()");const d=new o.default;console.trace("new JSZip");let s=JSON.stringify(i.value.content);var j=d.folder(l.value),k=j.folder("files");console.trace("document + folders"),f.value.forEach(y=>{console.trace("files foreach",y.name),s=s.replaceAll(y.url,"files/"+y.name),k.file(y.name,B(y.url),{binary:!0})}),j.file("oda.json",s),console.trace("added document"),d.generateAsync({type:"blob"}).then(function(y){J(y,l.value+".zip"),console.trace("saveAs")})},blockprops:S,getUserTemplates:e}});export{$ as u};
