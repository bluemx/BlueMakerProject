import{J as U,B as T,a2 as H,u as X,i as b,s as E,_ as F}from"./app-15fa318a.js";var L={};L._getBinaryFromXHR=function(p){return p.response||p.responseText};function M(){try{return new window.XMLHttpRequest}catch{}}function D(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch{}}var P=typeof window<"u"&&window.ActiveXObject?function(){return M()||D()}:M;L.getBinaryContent=function(p,c){var l,f,i,v;c||(c={}),typeof c=="function"?(v=c,c={}):typeof c.callback=="function"&&(v=c.callback),!v&&typeof Promise<"u"?l=new Promise(function(r,w){f=r,i=w}):(f=function(r){v(null,r)},i=function(r){v(r,null)});try{var a=P();a.open("GET",p,!0),"responseType"in a&&(a.responseType="arraybuffer"),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.onreadystatechange=function(r){if(a.readyState===4)if(a.status===200||a.status===0)try{f(L._getBinaryFromXHR(a))}catch(w){i(new Error(w))}else i(new Error("Ajax error for "+p+" : "+this.status+" "+this.statusText))},c.progress&&(a.onprogress=function(r){c.progress({path:p,originalEvent:r,percent:r.loaded/r.total*100,loaded:r.loaded,total:r.total})}),a.send()}catch(r){i(new Error(r),null)}return l};var q=L;const J=U(q);var B={exports:{}};(function(p,c){(function(l,f){f()})(T,function(){function l(e,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e}function f(e,t,m){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){w(n.response,t,m)},n.onerror=function(){console.error("could not download file")},n.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function v(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof T=="object"&&T.global===T?T:void 0,r=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),w=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(e,t,m){var n=a.URL||a.webkitURL,u=document.createElement("a");t=t||e.name||"download",u.download=t,u.rel="noopener",typeof e=="string"?(u.href=e,u.origin===location.origin?v(u):i(u.href)?f(e,t,m):v(u,u.target="_blank")):(u.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(u.href)},4e4),setTimeout(function(){v(u)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,m){if(t=t||e.name||"download",typeof e!="string")navigator.msSaveOrOpenBlob(l(e,m),t);else if(i(e))f(e,t,m);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){v(n)})}}:function(e,t,m,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return f(e,t,m);var u=e.type==="application/octet-stream",_=/constructor/i.test(a.HTMLElement)||a.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent);if((h||u&&_||r)&&typeof FileReader<"u"){var R=new FileReader;R.onloadend=function(){var g=R.result;g=h?g:g.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=g:location=g,n=null},R.readAsDataURL(e)}else{var S=a.URL||a.webkitURL,j=S.createObjectURL(e);n?n.location=j:location.href=j,n=null,setTimeout(function(){S.revokeObjectURL(j)},4e4)}});a.saveAs=w.saveAs=w,p.exports=w})})(B);var x=B.exports;const C=U(x),$=H("builder",()=>{const p=X(),c=b(null),l=b(null),f=b(),i=b(),v=b(null),a=b(),r=b({}),w=b([]),e=async()=>{const{data:o,error:d}=await E.from("usertemplates").select("*").eq("type",c.value);return o.value=o,o},t=async(o,d)=>{const{data:s,error:A}=await E.from("documents").insert([{key:o,content:d}]).select().single();p.push(`/${c.value}/${s.key}`)},m=async o=>{i.value=o;const{data:d,error:s}=await E.from("documents").select("*").eq("key",o).single();return l.value=d,j(),!0},n=()=>l.value?l.value.content:null,u=o=>{const{data:d}=E.storage.from(c.value).getPublicUrl(i.value+"/"+o);return d.publicUrl},_=async()=>{console.log("guardando...",l.value),await E.from("documents").update(l.value).eq("key",i.value)},h=()=>{},R=async()=>{const{data:o,error:d}=await E.from("modulos").select("*").eq("type",c.value);return o.value=o,o==null||o.forEach(s=>{r.value[s.name]={...s.schema,icon:s.icon,color:s.color}}),o},S=o=>r.value[o],j=async()=>{f.value=[];const{data:o,error:d}=await E.storage.from(c.value).list(i.value,{limit:100,offset:0,sortBy:{column:"name",order:"asc"}});o.forEach(s=>{f.value.push({name:s.name,url:u(s.name),mimetype:s.metadata.mimetype})})},g=(o,d)=>{var s;(s=l.value.content)!=null&&s.metadata||(l.value.content.metadata={}),l.value.content.metadata[o]=d},O=async o=>new Promise(function(d,s){J.getBinaryContent(o,function(A,k){A?s(A):d(k)})});return{menu:v,usertemplates:w,type:c,doc:l,dockey:i,files:f,modulos:a,modulosobj:r,newDoc:t,loadDoc:m,getContent:n,updateAssets:j,saveDoc:_,downloadDoc:h,loadModulos:R,metadata:g,download:async()=>{const o=await F(()=>import("./jszip-5f87a215.js").then(y=>y.j),["assets/jszip-5f87a215.js","assets/app-15fa318a.js","assets/index-f493eef3.css"]);console.trace("download()");const d=new o.default;console.trace("new JSZip");let s=JSON.stringify(l.value.content);var A=d.folder(i.value),k=A.folder("files");console.trace("document + folders"),f.value.forEach(y=>{console.trace("files foreach",y.name),s=s.replaceAll(y.url,"files/"+y.name),k.file(y.name,O(y.url),{binary:!0})}),A.file("oda.json",s),console.trace("added document"),d.generateAsync({type:"blob"}).then(function(y){C(y,i.value+".zip"),console.trace("saveAs")})},blockprops:S,getUserTemplates:e}});export{$ as u};
