import{C as k,B as R,Q as O,u as U,l as b,s as g,_ as H}from"./app-380ca943.js";var S={};S._getBinaryFromXHR=function(v){return v.response||v.responseText};function M(){try{return new window.XMLHttpRequest}catch{}}function X(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch{}}var F=typeof window<"u"&&window.ActiveXObject?function(){return M()||X()}:M;S.getBinaryContent=function(v,c){var l,d,i,p;c||(c={}),typeof c=="function"?(p=c,c={}):typeof c.callback=="function"&&(p=c.callback),!p&&typeof Promise<"u"?l=new Promise(function(r,w){d=r,i=w}):(d=function(r){p(null,r)},i=function(r){p(r,null)});try{var a=F();a.open("GET",v,!0),"responseType"in a&&(a.responseType="arraybuffer"),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.onreadystatechange=function(r){if(a.readyState===4)if(a.status===200||a.status===0)try{d(S._getBinaryFromXHR(a))}catch(w){i(new Error(w))}else i(new Error("Ajax error for "+v+" : "+this.status+" "+this.statusText))},c.progress&&(a.onprogress=function(r){c.progress({path:v,originalEvent:r,percent:r.loaded/r.total*100,loaded:r.loaded,total:r.total})}),a.send()}catch(r){i(new Error(r),null)}return l};var D=S;const P=k(D);var B={exports:{}};(function(v,c){(function(l,d){d()})(R,function(){function l(e,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e}function d(e,t,m){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){w(n.response,t,m)},n.onerror=function(){console.error("could not download file")},n.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function p(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var a=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof R=="object"&&R.global===R?R:void 0,r=a.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),w=a.saveAs||(typeof window!="object"||window!==a?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(e,t,m){var n=a.URL||a.webkitURL,u=document.createElement("a");t=t||e.name||"download",u.download=t,u.rel="noopener",typeof e=="string"?(u.href=e,u.origin===location.origin?p(u):i(u.href)?d(e,t,m):p(u,u.target="_blank")):(u.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(u.href)},4e4),setTimeout(function(){p(u)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,m){if(t=t||e.name||"download",typeof e!="string")navigator.msSaveOrOpenBlob(l(e,m),t);else if(i(e))d(e,t,m);else{var n=document.createElement("a");n.href=e,n.target="_blank",setTimeout(function(){p(n)})}}:function(e,t,m,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof e=="string")return d(e,t,m);var u=e.type==="application/octet-stream",L=/constructor/i.test(a.HTMLElement)||a.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent);if((j||u&&L||r)&&typeof FileReader<"u"){var A=new FileReader;A.onloadend=function(){var o=A.result;o=j?o:o.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=o:location=o,n=null},A.readAsDataURL(e)}else{var h=a.URL||a.webkitURL,T=h.createObjectURL(e);n?n.location=T:location.href=T,n=null,setTimeout(function(){h.revokeObjectURL(T)},4e4)}});a.saveAs=w.saveAs=w,v.exports=w})})(B);var q=B.exports;const C=k(q),J=O("builder",()=>{const v=U(),c=b(null),l=b(null),d=b(),i=b(),p=b(null),a=b(),r=b({}),w=async(o,f)=>{const{data:s,error:E}=await g.from("documents").insert([{key:o,content:f}]).select().single();v.push(`/${c.value}/${s.key}`)},e=async o=>{i.value=o;const{data:f,error:s}=await g.from("documents").select("*").eq("key",o).single();return l.value=f,j(),!0},t=()=>l.value?l.value.content:null,m=o=>{const{data:f}=g.storage.from(c.value).getPublicUrl(i.value+"/"+o);return f.publicUrl},n=async()=>{await g.from("documents").update(l.value).eq("key",i.value)},u=()=>{},L=async()=>{const{data:o,error:f}=await g.from("modulos").select("*").eq("type",c.value);return o.value=o,o==null||o.forEach(s=>{r.value[s.name]={...s.schema,icon:s.icon}}),o},j=async()=>{d.value=[];const{data:o,error:f}=await g.storage.from(c.value).list(i.value,{limit:100,offset:0,sortBy:{column:"name",order:"asc"}});o.forEach(s=>{d.value.push({name:s.name,url:m(s.name),mimetype:s.metadata.mimetype})})},A=(o,f)=>{var s;(s=l.value.content)!=null&&s.metadata||(l.value.content.metadata={}),l.value.content.metadata[o]=f},h=async o=>new Promise(function(f,s){P.getBinaryContent(o,function(E,_){E?s(E):f(_)})});return{menu:p,type:c,doc:l,dockey:i,files:d,modulos:a,modulosobj:r,newDoc:w,loadDoc:e,getContent:t,updateAssets:j,saveDoc:n,downloadDoc:u,loadModulos:L,metadata:A,download:async()=>{const o=await H(()=>import("./jszip-c61eb4cc.js").then(y=>y.j),["assets/jszip-c61eb4cc.js","assets/app-380ca943.js","assets/index-18a01d66.css"]);console.trace("download()");const f=new o.default;console.trace("new JSZip");let s=JSON.stringify(l.value.content);var E=f.folder(i.value),_=E.folder("files");console.trace("document + folders"),d.value.forEach(y=>{console.trace("files foreach",y.name),s=s.replaceAll(y.url,"files/"+y.name),_.file(y.name,h(y.url),{binary:!0})}),E.file("oda.json",s),console.trace("added document"),f.generateAsync({type:"blob"}).then(function(y){C(y,i.value+".zip"),console.trace("saveAs")})}}});export{J as u};
